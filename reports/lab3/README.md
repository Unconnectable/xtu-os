# 内存动态分区分配与回收模拟程序设计说明(CXX 实现)

## 一、项目目标

设计并模拟实现内存的动态分区分配与回收机制.通过 C 语言程序模拟内存管理过程,支持作业的动态内存申请与释放,并采用首次适应(First Fit)算法进行内存分配.

---

## 二、内存模拟结构

### 1. 内存空间模拟

使用一个长度为 `1024` 的一维数组来模拟整个内存空间,每个元素表示一个内存单位.

### 2. 空闲分区记录方式

建立空闲分区表或空闲分区链表,用于记录当前所有未被占用的内存区域.每个空闲分区应至少包括以下信息:

- 起始地址
- 分区大小
- 分区状态(是否已被占用)
- 作业号(若已分配)

---

## 三、功能要求

### 1. 内存分配

- 接收用户从键盘输入的作业请求,格式为三元组:
  **(作业号,作业大小,运行时间)**
  其中:
  - 作业号范围:0 ~ 9
  - 作业大小范围:1 ~ 1024
  - 运行时间为虚拟参数,不影响实际内存操作
- 使用 `First Fit` 算法查找第一个足够大的空闲分区进行分配.
- 若找到合适分区,则进行分配;否则提示“内存不足,无法分配”.

### 2. 内存回收

- 提供 `free(JobID)` 函数用于回收指定作业号所占内存.
- 回收后检查相邻的前后分区是否为空闲,若为空闲则进行合并,以减少内存碎片.
- 合并规则示例:
  - 分区序列 `3` 和 `4` 均为空闲 → 合并为分区 `3`
  - 分区序列 `4` 和 `5` 均为空闲 → 合并为分区 `4`

---

## 四、输出要求

- 所有操作结果需在屏幕上显示,包括:
  - 分配成功与否的信息
  - 回收成功的信息
  - 当前内存状态简要展示(可选)

---

## 五、算法说明:首次适应(First Fit)

### 1. `Allocate(JobID, Size)`

- 遍历空闲分区表(或链表),寻找第一个大小大于等于所需内存的空闲分区.
- 如果找到合适的分区,则从中划分出相应大小给该作业.
- 更新空闲分区表,并记录作业的内存分配情况.

### 2. `free(JobID)`

- 查找对应作业所占内存区域.
- 将其标记为空闲.
- 检查前一个和后一个分区是否也为空闲,若为空闲则合并成一个更大的空闲块.
- 更新空闲分区表.

```plaintext
  ┌───────────────────────┬────────────────────┬──────────────────┬──────────────────────┐
  │  Block 1              │  Block 2           │  Block 3         │  Block 4             │
  │  Job ID: 1            │  Job ID: 2         │  Job ID: 3       │  [Free]              │
  │  Start: 0             │  Start: 200        │  Start: 350      │  Start: 450          │
  │  Size: 200            │  Size: 150         │  Size: 100       │  Size: 100           │
  ├───────────────────────┼────────────────────┼──────────────────┼──────────────────────┤
  │  Block 5              │  Block 6           │  Block 7         │  Block 8             │
  │  [Free]               │  [Free]            │  [Free]          │  [Free]              │
  │  Start: 550           │  Start: 650        │  Start: 750      │  Start: 850          │
  │  Size: 100            │  Size: 100         │  Size: 100       │  Size: 150           │
  └───────────────────────┴────────────────────┴──────────────────┴──────────────────────┘

```

## 测试用例表

| 测试编号 | 场景描述 | 预期结果 |
| -------- | -------- | -------- |
| 0        | 正常分配 | 可分配   |
| 1        | 异常分配 | 分配失败 |
| 2        | 正常回收 | 回收成功 |
| 2        | 异常回收 | 回收失败 |
